---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <section class="section min-h-screen bg-gray-50 py-10">
    <div class="max-w-4xl mx-auto bg-white rounded-xl p-6 shadow space-y-12">
      <!-- ====== B34: Datos de Contacto y Entrega ====== -->
      <div>
        <h2 class="text-2xl font-semibold mb-4">Datos de Entrega</h2>
        <form id="form-entrega" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block mb-1 text-sm">Nombre</label>
              <input
                type="text"
                class="w-full border p-2 rounded"
                placeholder="Nombre completo"
                required
              />
            </div>
            <div>
              <label class="block mb-1 text-sm">Teléfono</label>
              <input
                type="tel"
                class="w-full border p-2 rounded"
                placeholder="+56 9 1234 5678"
                required
              />
            </div>
            <div>
              <label class="block mb-1 text-sm">Email</label>
              <input
                type="email"
                class="w-full border p-2 rounded"
                placeholder="correo@ejemplo.com"
                required
              />
            </div>
          </div>

          <div>
            <label class="block mb-1 text-sm">Método de Entrega</label>
            <select id="metodo-entrega" class="w-full border p-2 rounded">
              <option value="delivery">Delivery</option>
              <option value="retiro">Retiro en Local</option>
            </select>
          </div>

          <div id="delivery-fields" class="space-y-4">
            <label class="block mb-1 text-sm">Dirección</label>
            <input
              type="text"
              class="w-full border p-2 rounded"
              placeholder="Dirección completa"
            />
            <label class="block mb-1 text-sm">Zona</label>
            <select class="w-full border p-2 rounded">
              <option>Zona 1 (+$1500)</option>
              <option>Zona 2 (+$2500)</option>
            </select>
          </div>

          <div id="retiro-fields" class="hidden">
            <p class="text-sm text-gray-600">
              Retiro en Sucursal Alameda 1146 – Sin cargo
            </p>
          </div>
        </form>
      </div>

      <!-- ====== B33: Procesar Pago ====== -->
      <div>
        <h2 class="text-2xl font-semibold mb-4">Pago</h2>
        <form id="form-pago" class="space-y-4">
          <p class="text-sm text-gray-600">
            Total a pagar: <strong id="total-pagar">$9.970</strong>
          </p>
          <!-- Al final de checkout.astro -->
          <div class="text-right mt-6">
            <a
              href="/Pagos"
              class="inline-block bg-blue-500 text-white px-4 py-2 rounded"
            >
              Ir a Pago Online
            </a>
          </div>
        </form>
        <div id="mensaje-pago" class="text-sm mt-2"></div>
      </div>
    </div>
  </section>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const metodoEntrega = document.getElementById("metodo-entrega"); 
    const deliveryFields = document.getElementById("delivery-fields");
    const retiroFields = document.getElementById("retiro-fields");
    const btnPago = document.getElementById("btn-pago");
    const mensajePago = document.getElementById("mensaje-pago");



    metodoEntrega?.addEventListener('change', () => {
        

        if (metodoEntrega && 'value' in metodoEntrega && metodoEntrega.value === "delivery") {
            // Se usa el encadenamiento opcional (?) para campos secundarios
            deliveryFields?.classList.remove("hidden");
            retiroFields?.classList.add("hidden");
        } else {
            deliveryFields?.classList.add("hidden");
            retiroFields?.classList.remove("hidden");
        }
    });


    btnPago?.addEventListener('click', () => {

        const estado = Math.random() < 0.7 ? "Aprobado" : "Rechazado"; 
        

        if (mensajePago) { 
            if (estado === "Aprobado") {
                mensajePago.textContent = "Pago aprobado. Orden #UN-2025-09-0042 generada."; 
            } else {
                mensajePago.textContent = "Pago rechazado. Conservamos tu carrito para reintento.";
            }
        }
    });
});
</script>
</Layout>
