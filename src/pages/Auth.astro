---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <section class="relative min-h-screen flex">
    <!-- üîπ Login / Reset / 2FA -->
    <div
      id="auth-left"
      class="w-1/2 flex items-center justify-center bg-white p-10 transition-all duration-500 opacity-100"
    >
      <div class="max-w-md w-full space-y-6">
        <!-- Login (por defecto visible) -->
        <div id="login-block">
          <h2 class="text-2xl font-bold text-primary">Bienvenido de Nuevo</h2>
          <p class="text-secondary text-sm mb-4">
            Ingresa tus credenciales para acceder
          </p>

          <form id="login-form" class="space-y-4">
            <label class="block text-sm text-primary">Email</label>
            <input
              type="email"
              id="email"
              class="input"
              placeholder="rol@demo.com"
            />
            <label class="block text-sm text-primary">Contrase√±a</label>
            <input
              type="password"
              id="password"
              class="input"
              placeholder="********"
            />
            <button
              type="submit"
              class="w-full bg-accent text-white rounded p-2 hover:bg-accent-secondary transition"
            >
              Iniciar Sesi√≥n
            </button>
          </form>

          <div class="flex justify-between text-sm mt-4">
            <a id="show-reset" href="#" class="text-accent hover:underline"
              >Olvid√© mi contrase√±a</a
            >
            <a id="show-2fa" href="#" class="text-accent hover:underline"
              >Configurar 2FA</a
            >
            <a id="show-registro" href="#" class="text-accent hover:underline"
              >Registrarme</a
            >
          </div>
        </div>

        <!-- Reset Password -->
        <div
          id="reset-block"
          class="hidden opacity-0 transition-all duration-500"
        >
          <h2 class="text-xl font-bold text-primary">Restablecer Contrase√±a</h2>
          <p class="text-secondary text-sm mb-4">
            Ingresa tu correo para enviarte un enlace
          </p>
          <form class="space-y-4">
            <label class="block text-sm text-primary">Email registrado</label>
            <input
              type="email"
              class="input"
              placeholder="correo@ejemplo.com"
            />
            <button
              class="w-full bg-accent text-white rounded p-2 hover:bg-accent-secondary transition"
            >
              Enviar enlace
            </button>
          </form>
          <a
            id="back-login"
            href="#"
            class="block mt-4 text-sm text-accent hover:underline"
            >‚Üê Volver al login</a
          >
        </div>

        <!-- 2FA -->
        <div
          id="twofa-block"
          class="hidden opacity-0 transition-all duration-500"
        >
          <h2 class="text-xl font-bold text-primary">Configurar 2FA</h2>
          <p class="text-secondary text-sm mb-4">
            Activa la autenticaci√≥n en dos pasos
          </p>
          <form class="space-y-4">
            <label class="block text-sm text-primary">N√∫mero de tel√©fono</label>
            <input type="tel" class="input" placeholder="+56 9 1234 5678" />
            <button
              class="w-full bg-accent text-white rounded p-2 hover:bg-accent-secondary"
              >Enviar c√≥digo</button
            >

            <label class="block text-sm text-primary"
              >C√≥digo de verificaci√≥n</label
            >
            <input type="text" class="input" placeholder="123456" />
            <button
              class="w-full bg-accent text-white rounded p-2 hover:bg-accent-secondary"
              >Activar 2FA</button
            >
          </form>
          <a
            id="back-login-2fa"
            href="#"
            class="block mt-4 text-sm text-accent hover:underline"
            >‚Üê Volver al login</a
          >
        </div>
      </div>
    </div>

    <!-- üîπ Registro (inverso: imagen izquierda, form derecha) -->
    <div
      id="registro-block"
      class="flex flex-row-reverse w-full absolute inset-0 transform translate-x-full transition-transform duration-500 ease-in-out"
    >
      <!-- Form -->
      <div class="w-1/2 flex items-center justify-center bg-white p-10">
        <div class="max-w-md w-full space-y-6">
          <h2 class="text-2xl font-bold text-primary">Crear Cuenta</h2>
          <p class="text-secondary text-sm mb-4">
            Ingresa tus datos para registrarte
          </p>
          <form class="space-y-4">
            <label class="block text-sm text-primary">Nombre</label>
            <input type="text" class="input" placeholder="Tu nombre" />
            <label class="block text-sm text-primary">Email</label>
            <input
              type="email"
              class="input"
              placeholder="correo@ejemplo.com"
            />
            <label class="block text-sm text-primary">Contrase√±a</label>
            <input type="password" class="input" placeholder="********" />
            <button
              class="w-full bg-accent text-white rounded p-2 hover:bg-accent-secondary transition"
            >
              Crear Cuenta
            </button>
          </form>
          <a
            id="back-login-reg"
            href="#"
            class="block mt-4 text-sm text-accent hover:underline"
            >‚Üê Volver al login</a
          >
        </div>
      </div>

      <!-- Imagen -->
      <div class="w-1/2 hidden md:block h-screen">
        <img
          src="/images/pasta.png"
          alt="Imagen restaurante"
          class="w-full h-full object-cover"
        />
      </div>
    </div>

    <!-- Imagen fija del login -->
    <div id="login-image" class="w-1/2 hidden md:block h-screen">
      <img
        src="/images/pasta.png"
        alt="Imagen restaurante"
        class="w-full h-full object-cover"
      />
    </div>
  </section>

  <!-- Script para login y mostrar/ocultar formularios -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
    const loginBlock = document.getElementById("login-block");
    const resetBlock = document.getElementById("reset-block");
    const twofaBlock = document.getElementById("twofa-block");
    const authLeft = document.getElementById("auth-left");
    const registroBlock = document.getElementById("registro-block");

    // -------- RESET --------
    document.getElementById("show-reset")?.addEventListener("click", (e) => {
      e.preventDefault();
      loginBlock?.classList.add("hidden");

      resetBlock?.classList.remove("hidden");
      resetBlock?.classList.remove("opacity-0");
      resetBlock?.classList.add("opacity-100");
    });

    document.getElementById("back-login")?.addEventListener("click", (e) => {
      e.preventDefault();
      resetBlock?.classList.add("hidden");
      loginBlock?.classList.remove("hidden");
    });

    // -------- 2FA --------
    document.getElementById("show-2fa")?.addEventListener("click", (e) => {
      e.preventDefault();
      loginBlock?.classList.add("hidden");

      twofaBlock?.classList.remove("hidden");
      twofaBlock?.classList.remove("opacity-0");
      twofaBlock?.classList.add("opacity-100");
    });

    document.getElementById("back-login-2fa")?.addEventListener("click", (e) => {
      e.preventDefault();
      twofaBlock?.classList.add("hidden");
      loginBlock?.classList.remove("hidden");
    });

    // -------- REGISTRO --------
    document.getElementById("show-registro")?.addEventListener("click", (e) => {
      e.preventDefault();
      authLeft?.classList.add("hidden");
      document.getElementById("login-image")?.classList.add("hidden");

      registroBlock?.classList.remove("hidden");
      setTimeout(() => {
        registroBlock?.classList.remove("translate-x-full");
        registroBlock?.classList.add("translate-x-0");
      }, 50);
    });

    document.getElementById("back-login-reg")?.addEventListener("click", (e) => {
      e.preventDefault();
      registroBlock?.classList.remove("translate-x-0");
      registroBlock?.classList.add("translate-x-full");

      setTimeout(() => {
        registroBlock?.classList.add("hidden");
        authLeft?.classList.remove("hidden");
        document.getElementById("login-image")?.classList.remove("hidden");
      }, 500);
    });
  });
    // Simulacion de registro
    const registroForm = document.getElementById("registro-form");
    registroForm?.addEventListener("submit", (e) => {
      e.preventDefault();
      alert("Usuario registrado (simulaci√≥n). Ahora puedes iniciar sesi√≥n.");
    });

    // Login con roles
    const loginForm = document.getElementById("login-form");
    loginForm?.addEventListener("submit", (e) => {
      e.preventDefault();
      const emailInput = document.getElementById("email") as HTMLInputElement;
      const passwordInput = document.getElementById(
        "password"
      ) as HTMLInputElement;

      if (!emailInput || !passwordInput) return;

      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      // Simulaci√≥n de credenciales
      if (email === "admin@demo.com" && password === "1234") {
        sessionStorage.setItem("rol", "admin");
        window.location.href = "/PanelAdmin";
      } else if (email === "cliente@demo.com" && password === "1234") {
        sessionStorage.setItem("rol", "cliente");
        window.location.href = "/";
      } else if (email === "despacho@demo.com" && password === "1234") {
        sessionStorage.setItem("rol", "despacho");
        window.location.href = "/PanelDespacho";
      } else if (email === "dueno@demo.com" && password === "1234") {
        sessionStorage.setItem("rol", "dueno");
        window.location.href = "PanelBoss";
      } else if (email === "bodega@demo.com" && password === "1234") {
        sessionStorage.setItem("rol", "bodega");
        window.location.href = "/bodega/Picking";
      } else {
        alert(
          "Credenciales inv√°lidas. Usa admin@demo.com o cliente@demo.com o despacho@demo.com o dueno@demo.com / 1234"
        );
      }
    });
  </script>
</Layout>
