---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <section class="min-h-screen flex flex-col lg:flex-row bg-gray-50">
    <!-- === Panel Izquierdo (Login / Reset / 2FA) === -->
    <div
      id="auth-left"
      class="w-full lg:w-1/2 flex items-center justify-center bg-white p-8 md:p-12 transition-all duration-500"
    >
      <div class="max-w-md w-full space-y-8">
        <!-- LOGIN -->
        <div id="login-block">
          <h2 class="text-3xl font-bold text-[#6E0F2C]">Bienvenido de nuevo</h2>
          <p class="text-gray-500 text-sm mb-6">
            Ingresa tus credenciales para acceder
          </p>

          <form id="login-form" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-[#6E0F2C]"
                >Email</label
              >
              <input
                type="email"
                id="email"
                class="w-full border rounded-lg p-3 focus:ring-2 focus:ring-[#6E0F2C]/40"
                placeholder="usuario@demo.com"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-[#6E0F2C]"
                >Contraseña</label
              >
              <input
                type="password"
                id="password"
                class="w-full border rounded-lg p-3 focus:ring-2 focus:ring-[#6E0F2C]/40"
                placeholder="********"
                required
              />
            </div>

            <button
              type="submit"
              class="w-full bg-[#6E0F2C] hover:bg-[#8B1E3F] text-white font-medium rounded-lg p-3 transition"
            >
              Iniciar Sesión
            </button>
          </form>

          <div
            class="flex flex-col sm:flex-row justify-between items-center text-sm mt-5 gap-y-3"
          >
            <a href="#" id="show-reset" class="text-[#6E0F2C] hover:underline"
              >Olvidé mi contraseña</a
            >
            <a href="#" id="show-2fa" class="text-[#6E0F2C] hover:underline"
              >Configurar 2FA</a
            >
            <a
              href="#"
              id="show-registro"
              class="text-[#6E0F2C] font-medium hover:underline">Registrarme</a
            >
          </div>
        </div>

        <!-- RESET -->
        <div id="reset-block" class="hidden transition-all duration-300">
          <h2 class="text-2xl font-bold text-[#6E0F2C]">
            Restablecer Contraseña
          </h2>
          <p class="text-gray-500 text-sm mb-6">
            Ingresa tu correo para enviarte un enlace de recuperación
          </p>
          <form class="space-y-4">
            <input
              type="email"
              class="w-full border rounded-lg p-3 focus:ring-2 focus:ring-[#6E0F2C]/40"
              placeholder="correo@ejemplo.com"
              required
            />
            <button
              class="w-full bg-[#6E0F2C] hover:bg-[#8B1E3F] text-white rounded-lg p-3 transition"
            >
              Enviar enlace
            </button>
          </form>
          <a
            href="#"
            id="back-login"
            class="block text-sm text-[#6E0F2C] mt-4 hover:underline"
            >← Volver al login</a
          >
        </div>

        <!-- 2FA -->
        <div id="twofa-block" class="hidden transition-all duration-300">
          <h2 class="text-2xl font-bold text-[#6E0F2C]">Configurar 2FA</h2>
          <p class="text-gray-500 text-sm mb-6">
            Activa la autenticación en dos pasos
          </p>
          <form class="space-y-4">
            <input
              type="tel"
              class="w-full border rounded-lg p-3 focus:ring-2 focus:ring-[#6E0F2C]/40"
              placeholder="+56 9 1234 5678"
            />
            <input
              type="text"
              class="w-full border rounded-lg p-3 focus:ring-2 focus:ring-[#6E0F2C]/40"
              placeholder="Código de verificación"
            />
            <button
              class="w-full bg-[#6E0F2C] hover:bg-[#8B1E3F] text-white rounded-lg p-3 transition"
            >
              Activar 2FA
            </button>
          </form>
          <a
            href="#"
            id="back-login-2fa"
            class="block text-sm text-[#6E0F2C] mt-4 hover:underline"
            >← Volver al login</a
          >
        </div>
      </div>
    </div>

    <!-- === Panel Derecho Imagen === -->
    <div
      id="login-image"
      class="hidden lg:flex w-1/2 bg-[#6E0F2C]/5 items-center justify-center"
    >
      <img
        src="/images/pasta.png"
        alt="Imagen restaurante"
        class="w-full h-full object-cover rounded-l-2xl"
      />
    </div>

    <!-- === PANEL REGISTRO === -->
    <div
      id="registro-block"
      class="fixed inset-0 bg-white flex flex-col lg:flex-row items-center justify-center opacity-0 pointer-events-none z-50
         transition-all duration-500 ease-in-out translate-y-4"
    >
      <div class="max-w-md w-full p-8 md:p-10 space-y-6">
        <h2 class="text-3xl font-bold text-[#6E0F2C]">Crear Cuenta</h2>
        <p class="text-gray-500 text-sm mb-4">
          Ingresa tus datos para registrarte
        </p>
        <form class="space-y-4" id="registro-form">
          <input
            type="text"
            class="w-full border rounded-lg p-3 focus:ring-2 focus:ring-[#6E0F2C]/40"
            placeholder="Nombre completo"
            required
          />
          <input
            type="email"
            class="w-full border rounded-lg p-3 focus:ring-2 focus:ring-[#6E0F2C]/40"
            placeholder="correo@ejemplo.com"
            required
          />
          <input
            type="password"
            class="w-full border rounded-lg p-3 focus:ring-2 focus:ring-[#6E0F2C]/40"
            placeholder="Contraseña"
            required
          />
          <button
            class="w-full bg-[#6E0F2C] hover:bg-[#8B1E3F] text-white rounded-lg p-3 transition"
          >
            Crear Cuenta
          </button>
        </form>
        <a
          href="#"
          id="back-login-reg"
          class="block text-sm text-[#6E0F2C] hover:underline"
          >← Volver al login</a
        >
      </div>
    </div>
  </section>

  <script>
    // @ts-nocheck
    document.addEventListener("DOMContentLoaded", () => {
      const loginBlock = document.getElementById("login-block");
      const resetBlock = document.getElementById("reset-block");
      const twofaBlock = document.getElementById("twofa-block");
      const registroBlock = document.getElementById("registro-block");

      // ===== Reset =====
      document.getElementById("show-reset")?.addEventListener("click", (e) => {
        e.preventDefault();
        loginBlock.classList.add("hidden");
        resetBlock.classList.remove("hidden");
      });

      document.getElementById("back-login")?.addEventListener("click", (e) => {
        e.preventDefault();
        resetBlock.classList.add("hidden");
        loginBlock.classList.remove("hidden");
      });

      // ===== 2FA =====
      document.getElementById("show-2fa")?.addEventListener("click", (e) => {
        e.preventDefault();
        loginBlock.classList.add("hidden");
        twofaBlock.classList.remove("hidden");
      });

      document
        .getElementById("back-login-2fa")
        ?.addEventListener("click", (e) => {
          e.preventDefault();
          twofaBlock.classList.add("hidden");
          loginBlock.classList.remove("hidden");
        });

      // ===== Registro =====
      const showRegistro = document.getElementById("show-registro");
      const backLoginReg = document.getElementById("back-login-reg");

      showRegistro?.addEventListener("click", (e) => {
        e.preventDefault();

        // Ocultar login
        loginBlock.classList.add("hidden");

        registroBlock.classList.remove("hidden", "pointer-events-none");
        registroBlock.classList.add("pointer-events-auto");

        registroBlock.classList.add("opacity-0", "translate-y-4");

        void registroBlock.offsetWidth;

        registroBlock.classList.remove("opacity-0", "translate-y-4");
      });

      backLoginReg?.addEventListener("click", (e) => {
        e.preventDefault();

        // Animación de salida
        registroBlock.classList.add("opacity-0", "translate-y-4");
        registroBlock.classList.remove("pointer-events-auto");

        setTimeout(() => {
          registroBlock.classList.add("hidden", "pointer-events-none");
          loginBlock.classList.remove("hidden");
        }, 500);
      });

      // ===== Login con roles (igual que antes) =====
      document.getElementById("login-form")?.addEventListener("submit", (e) => {
        e.preventDefault();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();

        if (email === "admin@demo.com" && password === "1234") {
          window.location.href = "/PanelAdmin";
        } else if (email === "cliente@demo.com" && password === "1234") {
          window.location.href = "/";
        } else if (email === "despacho@demo.com" && password === "1234") {
          window.location.href = "/PanelDespacho";
        } else if (email === "dueno@demo.com" && password === "1234") {
          window.location.href = "/PanelBoss";
        } else if (email === "bodega@demo.com" && password === "1234") {
          window.location.href = "/bodega/Picking";
        } else {
          alert(
            "⚠️ Credenciales inválidas. Usa admin@demo.com o cliente@demo.com (1234)"
          );
        }
      });
    });
  </script>
</Layout>
